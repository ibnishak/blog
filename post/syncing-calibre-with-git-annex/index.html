<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.111.3">

  <title> Syncing Calibre With Git Annex |  Treppenwitze</title>
  <meta name="description" content="Thoughts, rants and notes">
  <link rel="apple-touch-icon" sizes="180x180" href="https://ibnishak.github.io/blog/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://ibnishak.github.io/blog/favicon-32x32.png">
  <link rel="icon" href="https://ibnishak.github.io/blog/favicon.ico">
  <link rel="manifest" href="https://ibnishak.github.io/blog/site.webmanifest">

  <link rel="stylesheet" href="https://ibnishak.github.io/blog/css/index.css">
  
  
  
  <link rel="canonical" href="https://ibnishak.github.io/blog/post/syncing-calibre-with-git-annex/">
  <link rel="alternate" type="application/rss+xml" href="" title="Treppenwitze">

</head>

<body >
  <header class="menus">
  

  <nav >
    
    <a href="/blog/"> Home</a>
    
    <a href="/blog/about/"> About</a>
    
    <a href="https://nilavara.surge.sh/?stackedNotes=000"> Digital Garden</a>
    
  </nav>

  <nav class="fontawesome">
    
    <a href="https://github.com/ibnishak" target="_blank">
        
		GitHub
    </a>
    
    
    <a href="https://ibnishak.github.io/blog/index.xml" target="_blank">
        
		RSS
    </a>
    
  </nav>
  
  
  <div class="hidden description">Thoughts, rants and notes</div>
  
</header>

<article id="article">
  <header>
	<div class="cat-into">
		

  
	</div>

    <h1 style="text-align: center;" >Syncing Calibre With Git Annex</h1>
    <div class="post-meta">
    
      <time datetime="2021-07-14T02:21:07&#43;05:30">July 14, 2021</time>  &nbsp; &nbsp;| 
    
    

    
	&nbsp; &nbsp; Reading Time:
      
      
      

      
        1 min
      
      15 s
      &nbsp;
    
    </div>
  </header>

  <p>Assuming that you want to keep only metadata and covers in your laptop while the books itself in external hard drive.</p>
<p>Dependencies: Rsync, Git-Annex</p>
<ul>
<li>Place script in PATH, name it <code>calibre-annex-sync.zsh</code> and make it executable.</li>
<li>Create 2 empty folders, one in your computer, other in external harddrive.</li>
<li>Edit the <code>USER VARIABLES</code> with absolute paths to the above 2 folders.</li>
<li>Run <code>calibre-annex-sync.zsh init</code> command.</li>
<li>Open Calibre. Start a new library in the folder in your computer.</li>
<li>Run the <code>calibre-annex-sync.zsh sync</code> to sync with external harddrive</li>
</ul>
<p>See help with <code>calibre-annex-sync.zsh --help</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env zsh
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>set -e <span style="color:#75715e"># Exit on error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#---------USER VARIABLES---------------#</span>
</span></span><span style="display:flex;"><span>SRCDIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/Documents/Library&#34;</span>
</span></span><span style="display:flex;"><span>TARGETDIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/External/Library&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#--------------------------------------#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>declare -r _VERSION<span style="color:#f92672">=</span>2.3.4
</span></span><span style="display:flex;"><span>declare -r _SCRIPT<span style="color:#f92672">=</span>$0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Init function takes 4 params dir1, name1, name2, dir2 in that order</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> setup<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> ! -d $1 <span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>			mkdir $1
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>	pushd $1
</span></span><span style="display:flex;"><span>	git init
</span></span><span style="display:flex;"><span>	git annex init $2
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;&lt;END &gt; .gitignore
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata_db_prefs_backup.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata.db
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*.jpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*.opf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">END</span>
</span></span><span style="display:flex;"><span>	git config annex.largefiles <span style="color:#e6db74">&#34;include=* exclude=*.opf exclude=*.json exclude=*.db exclude=*.jpg&#34;</span>
</span></span><span style="display:flex;"><span>	git remote add $3 $4 
</span></span><span style="display:flex;"><span>	git annex add . 
</span></span><span style="display:flex;"><span>	git commit -a -m <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> 
</span></span><span style="display:flex;"><span>	popd
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	setup $SRCDIR <span style="color:#e6db74">&#34;SRC&#34;</span> <span style="color:#e6db74">&#34;TARGET&#34;</span> $TARGETDIR
</span></span><span style="display:flex;"><span>	setup $TARGETDIR <span style="color:#e6db74">&#34;TARGET&#34;</span> <span style="color:#e6db74">&#34;SRC&#34;</span> $SRCDIR
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func sync<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	pushd $SRCDIR
</span></span><span style="display:flex;"><span>	git annex add . 
</span></span><span style="display:flex;"><span>	git commit -a -m <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> 
</span></span><span style="display:flex;"><span>	git annex sync 
</span></span><span style="display:flex;"><span>	git annex move . --to TARGET 
</span></span><span style="display:flex;"><span>	rsync -av --delete --exclude<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.git/&#34;</span> --include <span style="color:#e6db74">&#39;*.jpg&#39;</span> --include <span style="color:#e6db74">&#39;*.opf&#39;</span> --include <span style="color:#e6db74">&#39;metadata*&#39;</span> --include<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*/&#34;</span> --exclude<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*&#34;</span>  . $TARGETDIR 
</span></span><span style="display:flex;"><span>	popd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	pushd $TARGETDIR
</span></span><span style="display:flex;"><span>	git annex sync 
</span></span><span style="display:flex;"><span>	popd
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func helpmenu<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;This script has 2 commands&#34;</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>_SCRIPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> init&#34;</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>_SCRIPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> sync&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--help&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    helpmenu
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> declare -f <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> &gt; /dev/null; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;&#39;</span>$1<span style="color:#e6db74">&#39; is not a known command&#34;</span> &gt;&amp;<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    helpmenu
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div>

  
  <footer>
    <hr>
    
  </footer>
  

  


  <div class="comments">



</div>

</article>



  
  
  
</body>
<div class="foot">
  
  
    &copy; 2019 - 2023 &#183; 
    <a href="/" target="_blank">Home</a> · Theme <a href="https://github.com/RainerChiang/simpleness" target="_blank">Simpleness</a> Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> &#183;
    <a href="#" aria-label="Go to Top"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
		<path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
	  </svg></a>
  

  
</div>



</html>
