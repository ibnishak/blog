<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.3"><title>Emacs - Adding clipboad.js to HTML exports | Treppenwitze</title><meta name=description content="Thoughts, rants and notes"><link rel=apple-touch-icon sizes=180x180 href=https://ibnishak.github.io/blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ibnishak.github.io/blog/favicon-32x32.png><link rel=icon href=https://ibnishak.github.io/blog/favicon.ico><link rel=manifest href=https://ibnishak.github.io/blog/site.webmanifest><link rel=stylesheet href=https://ibnishak.github.io/blog/css/index.css><link rel=canonical href=https://ibnishak.github.io/blog/post/emacs-adding-clipboard-js-to-html-exports/><link rel=alternate type=application/rss+xml href title=Treppenwitze></head><body><header class=menus><nav><a href=/blog/>Home</a>
<a href=/blog/about/>About</a>
<a href="https://nilavara.surge.sh/?stackedNotes=000">Digital Garden</a></nav><nav class=fontawesome><a href=https://github.com/ibnishak target=_blank>GitHub</a>
<a href=https://ibnishak.github.io/blog/index.xml target=_blank>RSS</a></nav><div class="hidden description">Thoughts, rants and notes</div></header><article id=article><header><div class=cat-into><span class=header-item>Category:
<a href=/blog/categories/digital>digital</a>
&nbsp;</span>
<span class=header-item>&nbsp;&nbsp;| &nbsp;&nbsp; Tags:
<a href=/blog/tags/emacs>emacs</a>
&nbsp;
<a href=/blog/tags/linux>linux</a>
&nbsp;</span></div><h1 style=text-align:center>Emacs - Adding clipboad.js to HTML exports</h1><div class=post-meta><time datetime=2019-09-18T00:00:00Z>September 18, 2019</time> &nbsp; &nbsp;|
&nbsp; &nbsp; Reading Time:
2 min
5 s
&nbsp;</div></header><p><a href=https://clipboardjs.com/>Clipboard.js</a> is a javascript solution to add copy buttons to <code>&lt;pre></code> or <code>&lt;code></code> regions in your html file. F</p><p>Since many of the Emacs community use org-publish for blogging, it seems like a good idea to note how to include clipboard.js snippets in the org mode html exports.</p><ul><li>Add the following to your <code>init.el</code></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp>(defun org-html-src-block (src-block contents info)
      <span style=color:#e6db74>&#34;Transcode a SRC-BLOCK element from Org to HTML.
</span><span style=color:#e6db74>    CONTENTS holds the contents of the item.  INFO is a plist holding
</span><span style=color:#e6db74>    contextual information.&#34;</span>
      (<span style=color:#66d9ef>if</span> (org-export-read-attribute <span style=color:#e6db74>:attr_html</span> src-block <span style=color:#e6db74>:textarea</span>)
          (org-html--textarea-block src-block)
        (<span style=color:#66d9ef>let*</span> ((lang (org-element-property <span style=color:#e6db74>:language</span> src-block))
    	  (caption (org-export-get-caption src-block))
    	  (code (org-html-format-code src-block info))
    	  (label (<span style=color:#66d9ef>let</span> ((lbl (and (org-element-property <span style=color:#e6db74>:name</span> src-block)
    				 (org-export-get-reference src-block info))))
    		   (<span style=color:#66d9ef>if</span> lbl (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34; id=\&#34;%s\&#34;&#34;</span> lbl)
    		     (concat <span style=color:#e6db74>&#34;btn_&#34;</span> (s-replace <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;&#34;</span> (org-id-new))))))
    	  (btnprops <span style=color:#e6db74>&#34; class=&#39;btn-clipboard&#39;  data-original-title=&#39;Copy to clipboard&#39;&#34;</span>)
    	  (button (concat <span style=color:#e6db74>&#34;&lt;div class=\&#34;bd-clipboard\&#34;&gt; &lt;button&#34;</span> btnprops <span style=color:#e6db74>&#34; data-clipboard-target=\&#34;#&#34;</span> label <span style=color:#e6db74>&#34;\&#34;&gt; Copy &lt;/button&gt; &lt;/div&gt;&#34;</span>)))
          (<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>not</span> lang) (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;&lt;pre class=\&#34;example\&#34;%s&gt;\n%s&lt;/pre&gt;&#34;</span> label code)
    	(<span style=color:#a6e22e>format</span>
    	 <span style=color:#e6db74>&#34;&lt;div class=\&#34;org-src-container\&#34;&gt;\n%s%s\n&lt;/div&gt;&#34;</span>
    	 (<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>not</span> caption) <span style=color:#e6db74>&#34;&#34;</span>
    	   (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;&lt;label class=\&#34;org-src-name\&#34;&gt;%s&lt;/label&gt;&#34;</span>
    		   (org-export-data caption info)))
    	 (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;%s\n&lt;pre class=\&#34;src src-%s\&#34; id=\&#34;%s\&#34;&gt;%s&lt;/pre&gt;&#34;</span> button lang label code))))))
    
    
    (defconst org-clipboardjs-script
    <span style=color:#e6db74>&#34;&lt;!-- 2. Include library --&gt;
</span><span style=color:#e6db74>        &lt;script src=\&#34;https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js\&#34;&gt;&lt;/script&gt;
</span><span style=color:#e6db74>    
</span><span style=color:#e6db74>        &lt;!-- 3. Instantiate clipboard by passing a string selector --&gt;
</span><span style=color:#e6db74>        &lt;script&gt;
</span><span style=color:#e6db74>        var clipboard = new ClipboardJS(&#39;.btn-clipboard&#39;);
</span><span style=color:#e6db74>        clipboard.on(&#39;success&#39;, function(e) {
</span><span style=color:#e6db74>    	console.log(e);
</span><span style=color:#e6db74>        });
</span><span style=color:#e6db74>        clipboard.on(&#39;error&#39;, function(e) {
</span><span style=color:#e6db74>    	console.log(e);
</span><span style=color:#e6db74>        });
</span><span style=color:#e6db74>        &lt;/script&gt;&#34;</span>
    <span style=color:#e6db74>&#34;Clipoard JS script to be included&#34;</span>
    )
    
    
    (defun org-html-template (contents info)
      <span style=color:#e6db74>&#34;Return complete document string after HTML conversion.
</span><span style=color:#e6db74>    CONTENTS is the transcoded contents string.  INFO is a plist
</span><span style=color:#e6db74>    holding export options.&#34;</span>
      (concat
       (when (and (<span style=color:#a6e22e>not</span> (org-html-html5-p info)) (org-html-xhtml-p info))
         (<span style=color:#66d9ef>let*</span> ((xml-declaration (plist-get info <span style=color:#e6db74>:html-xml-declaration</span>))
    	    (decl (or (and (<span style=color:#a6e22e>stringp</span> xml-declaration) xml-declaration)
    		      (<span style=color:#a6e22e>cdr</span> (<span style=color:#a6e22e>assoc</span> (plist-get info <span style=color:#e6db74>:html-extension</span>)
    				  xml-declaration))
    		      (<span style=color:#a6e22e>cdr</span> (<span style=color:#a6e22e>assoc</span> <span style=color:#e6db74>&#34;html&#34;</span> xml-declaration))
    		      <span style=color:#e6db74>&#34;&#34;</span>)))
           (when (<span style=color:#a6e22e>not</span> (or (<span style=color:#a6e22e>not</span> decl) (<span style=color:#a6e22e>string=</span> <span style=color:#e6db74>&#34;&#34;</span> decl)))
    	 (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;%s\n&#34;</span>
    		 (<span style=color:#a6e22e>format</span> decl
    			 (or (and org-html-coding-system
    				  (<span style=color:#a6e22e>fboundp</span> <span style=color:#e6db74>&#39;coding-system-get</span>)
    				  (coding-system-get org-html-coding-system <span style=color:#e6db74>&#39;mime-charset</span>))
    			     <span style=color:#e6db74>&#34;iso-8859-1&#34;</span>))))))
       (org-html-doctype info)
       <span style=color:#e6db74>&#34;\n&#34;</span>
       (concat <span style=color:#e6db74>&#34;&lt;html&#34;</span>
    	   (when (org-html-xhtml-p info)
    	     (<span style=color:#a6e22e>format</span>
    	      <span style=color:#e6db74>&#34; xmlns=\&#34;http://www.w3.org/1999/xhtml\&#34; lang=\&#34;%s\&#34; xml:lang=\&#34;%s\&#34;&#34;</span>
    	      (plist-get info <span style=color:#e6db74>:language</span>) (plist-get info <span style=color:#e6db74>:language</span>)))
    	   <span style=color:#e6db74>&#34;&gt;\n&#34;</span>)
       <span style=color:#e6db74>&#34;&lt;head&gt;\n&#34;</span>
       (org-html--build-meta-info info)
       (org-html--build-head info)
       (org-html--build-mathjax-config info)
       <span style=color:#e6db74>&#34;&lt;/head&gt;\n&#34;</span>
       <span style=color:#e6db74>&#34;&lt;body&gt;\n&#34;</span>
       (<span style=color:#66d9ef>let</span> ((link-up (org-trim (plist-get info <span style=color:#e6db74>:html-link-up</span>)))
    	 (link-home (org-trim (plist-get info <span style=color:#e6db74>:html-link-home</span>))))
         (unless (and (<span style=color:#a6e22e>string=</span> link-up <span style=color:#e6db74>&#34;&#34;</span>) (<span style=color:#a6e22e>string=</span> link-home <span style=color:#e6db74>&#34;&#34;</span>))
           (<span style=color:#a6e22e>format</span> (plist-get info <span style=color:#e6db74>:html-home/up-format</span>)
    	       (or link-up link-home)
    	       (or link-home link-up))))
       <span style=color:#75715e>;; Preamble.</span>
       (org-html--build-pre/postamble <span style=color:#e6db74>&#39;preamble</span> info)
       <span style=color:#75715e>;; Document contents.</span>
       (<span style=color:#66d9ef>let</span> ((div (assq <span style=color:#e6db74>&#39;content</span> (plist-get info <span style=color:#e6db74>:html-divs</span>))))
         (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;&lt;%s id=\&#34;%s\&#34;&gt;\n&#34;</span> (<span style=color:#a6e22e>nth</span> <span style=color:#ae81ff>1</span> div) (<span style=color:#a6e22e>nth</span> <span style=color:#ae81ff>2</span> div)))
       <span style=color:#75715e>;; Document title.</span>
       (when (plist-get info <span style=color:#e6db74>:with-title</span>)
         (<span style=color:#66d9ef>let</span> ((title (plist-get info <span style=color:#e6db74>:title</span>))
    	   (subtitle (plist-get info <span style=color:#e6db74>:subtitle</span>)))
           (when title
    	 (<span style=color:#a6e22e>format</span>
    	  (<span style=color:#66d9ef>if</span> (plist-get info <span style=color:#e6db74>:html-html5-fancy</span>)
    	      <span style=color:#e6db74>&#34;&lt;header&gt;\n&lt;h1 class=\&#34;title\&#34;&gt;%s&lt;/h1&gt;\n%s&lt;/header&gt;&#34;</span>
    	    <span style=color:#e6db74>&#34;&lt;h1 class=\&#34;title\&#34;&gt;%s%s&lt;/h1&gt;\n&#34;</span>)
    	  (org-export-data title info)
    	  (<span style=color:#66d9ef>if</span> subtitle
    	      (<span style=color:#a6e22e>format</span>
    	       (<span style=color:#66d9ef>if</span> (plist-get info <span style=color:#e6db74>:html-html5-fancy</span>)
    		   <span style=color:#e6db74>&#34;&lt;p class=\&#34;subtitle\&#34;&gt;%s&lt;/p&gt;\n&#34;</span>
    		 <span style=color:#e6db74>&#34;\n&lt;br&gt;\n&lt;span class=\&#34;subtitle\&#34;&gt;%s&lt;/span&gt;\n&#34;</span>)
    	       (org-export-data subtitle info))
    	    <span style=color:#e6db74>&#34;&#34;</span>)))))
       contents
       (<span style=color:#a6e22e>format</span> <span style=color:#e6db74>&#34;&lt;/%s&gt;\n&#34;</span> (<span style=color:#a6e22e>nth</span> <span style=color:#ae81ff>1</span> (assq <span style=color:#e6db74>&#39;content</span> (plist-get info <span style=color:#e6db74>:html-divs</span>))))
       <span style=color:#75715e>;; Postamble.</span>
       (org-html--build-pre/postamble <span style=color:#e6db74>&#39;postamble</span> info)
    
       (org-element-normalize-string org-clipboardjs-script)
       <span style=color:#75715e>;; Closing document.</span>
       <span style=color:#e6db74>&#34;&lt;/body&gt;\n&lt;/html&gt;&#34;</span>))
</code></pre></div><ul><li>Reload your configuration with <code>M-x eval-buffer</code> on init.el</li><li>Now export any org file with <code>M-x org-html-export-to-html</code> or with shortcut keys C-c C-e h h</li></ul><footer><hr></footer><div class=releated-post><h3>Related Posts</h3><a href=/blog/post/emacs-notes-on-keybindings-in-linux/>Emacs: Notes on keybindings in GNU+Linux</a><br><a href=/blog/post/zsh-parameter-expansion-cheatsheet/>zsh: Parameter expansion cheatsheet</a><br></div><div class=comments></div></article></body><div class=foot>&copy; 2019 - 2022 &#183;
<a href=/>Home</a> · Theme <a href=https://github.com/RainerChiang/simpleness>Simpleness</a> Powered by <a href=https://gohugo.io/>Hugo</a> &#183;
<a href=#><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-chevron-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 4.646a.5.5.0 01.708.0l6 6a.5.5.0 01-.708.708L8 5.707l-5.646 5.647a.5.5.0 01-.708-.708l6-6z"/></svg></a></div><script src=/blog/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById('article')});</script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-bash.min.js integrity="sha512-CILPDr/8BlkkElCeI+f2yMu0fzgwWqpQ0Cdr0busFfySJJ4SoCRivbT6+Z+SWPkjWwBil9NO0tHd6NSfpwiQaA==" crossorigin=anonymous></script></html>